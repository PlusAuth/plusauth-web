"use strict";var I=Object.defineProperty;var K=(e,t,r)=>t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var f=(e,t,r)=>(K(e,typeof t!="symbol"?t+"":t,r),r);Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});function D(e){return new TextEncoder().encode(e)}function d(e){const t=new Uint8Array(e);let r="";for(const i of t)r+=String.fromCharCode(i);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function b(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=(4-t.length%4)%4,n=t.padEnd(t.length+r,"="),i=atob(n),a=new ArrayBuffer(i.length),o=new Uint8Array(a);for(let s=0;s<i.length;s++)o[s]=i.charCodeAt(s);return a}function p(){return(window==null?void 0:window.PublicKeyCredential)!==void 0&&typeof window.PublicKeyCredential=="function"}function E(e){const{id:t}=e;return{...e,id:b(t),transports:e.transports}}function v(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}class l extends Error{constructor(t,r="WebAuthnError"){super(t),this.name=r}}function R({error:e,options:t}){var r,n;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal===new AbortController().signal)return new l("Registration ceremony was sent an abort signal","AbortError")}else if(e.name==="ConstraintError"){if(((r=i.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new l("Discoverable credentials were required but no available authenticator supported it","ConstraintError");if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new l("User verification was required but no available authenticator supported it","ConstraintError")}else{if(e.name==="InvalidStateError")return new l("The authenticator was previously registered","InvalidStateError");if(e.name==="NotAllowedError")return new l("User clicked cancel, or the registration ceremony timed out","NotAllowedError");if(e.name==="NotSupportedError")return i.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new l('No entry in pubKeyCredParams was of type "public-key"',"NotSupportedError"):new l("No available authenticator supported any of the specified pubKeyCredParams algorithms","NotSupportedError");if(e.name==="SecurityError"){const a=window.location.hostname;if(v(a)){if(i.rp.id!==a)return new l(`The RP ID "${i.rp.id}" is invalid for this domain`,"SecurityError")}else return new l(`${window.location.hostname} is an invalid domain`,"SecurityError")}else if(e.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new l("User ID was not between 1 and 64 characters","TypeError")}else if(e.name==="UnknownError")return new l("The authenticator was unable to process the specified options, or could not create a new credential","UnknownError")}return e}class T{createNewAbortSignal(){return this.controller&&this.controller.abort("Cancelling existing WebAuthn API call for new one"),this.controller=new AbortController,this.controller.signal}}const S=new T;async function U(e){if(!p())throw new Error("WebAuthn is not supported in this browser");const r={publicKey:{...e,challenge:b(e.challenge),user:{...e.user,id:D(e.user.id)},excludeCredentials:e.excludeCredentials.map(E)}};r.signal=S.createNewAbortSignal();let n;try{n=await navigator.credentials.create(r)}catch(h){throw R({error:h,options:r})}if(!n)throw new Error("Registration was not completed");const{id:i,rawId:a,response:o,type:s}=n,u={id:i,rawId:d(a),response:{attestationObject:d(o.attestationObject),clientDataJSON:d(o.clientDataJSON)},type:s,clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:n.authenticatorAttachment};return typeof o.getTransports=="function"&&(u.transports=o.getTransports()),u}function W(e){return new TextDecoder("utf-8").decode(e)}async function C(){if(navigator.credentials.conditionalMediationSupported)return!0;const e=window.PublicKeyCredential;return e.isConditionalMediationAvailable!==void 0&&e.isConditionalMediationAvailable()}function _({error:e,options:t}){var r;const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal===new AbortController().signal)return new l("Authentication ceremony was sent an abort signal","AbortError")}else{if(e.name==="NotAllowedError")return!((r=n.allowCredentials)===null||r===void 0)&&r.length?new l("No available authenticator recognized any of the allowed credentials","NotAllowedError"):new l("User clicked cancel, or the authentication ceremony timed out","NotAllowedError");if(e.name==="SecurityError"){const i=window.location.hostname;if(v(i)){if(n.rpId!==i)return new l(`The RP ID "${n.rpId}" is invalid for this domain`,"SecurityError")}else return new l(`${window.location.hostname} is an invalid domain`,"SecurityError")}else if(e.name==="UnknownError")return new l("The authenticator was unable to process the specified options, or could not create a new assertion signature","UnknownError")}return e}async function $(e,t=!1){var r,n;if(!p())throw new Error("WebAuthn is not supported in this browser");let i;((r=e.allowCredentials)===null||r===void 0?void 0:r.length)!==0&&(i=(n=e.allowCredentials)===null||n===void 0?void 0:n.map(E));const a={...e,challenge:b(e.challenge),allowCredentials:i},o={};if(t){if(!await C())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete*='webauthn']").length<1)throw Error('No <input> with `"webauthn"` in its `autocomplete` attribute was detected');o.mediation="conditional",a.allowCredentials=[]}o.publicKey=a,o.signal=S.createNewAbortSignal();let s;try{s=await navigator.credentials.get(o)}catch(y){throw _({error:y,options:o})}if(!s)throw new Error("Authentication was not completed");const{id:u,rawId:h,response:c,type:w}=s;let m;return c.userHandle&&(m=W(c.userHandle)),{id:u,rawId:d(h),response:{authenticatorData:d(c.authenticatorData),clientDataJSON:d(c.clientDataJSON),signature:d(c.signature),userHandle:m},type:w,clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:s.authenticatorAttachment}}async function j(){return p()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1}function A(e,t){return new Promise(function(r,n){fetch(e,t).then(i=>{const a=i.headers.get("content-type");let o=null;i.text().then(s=>{if(a&&a.indexOf("application/json")>-1?o=Object.assign(JSON.parse(s),{_raw:i}):o={data:s,_raw:i},i.ok)r(o);else{if(i.status===400&&o.error==="xhr_request"&&o.location)return window.location.replace(o.location),!1;n(o)}})}).catch(n)})}class g{constructor(t,r){f(this,"http");f(this,"constructor");const n={};["get","post","patch","delete"].forEach(i=>{n[i]=function(...a){const o=Object.assign({method:i,credentials:"include",mode:"cors"},r||{});return o.headers=Object.assign({"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},o.headers||{}),i!=="get"&&(o.body=JSON.stringify(a[1])),typeof a[0]!="string"?A.call(null,t,o):A.call(null,t+a[0],o)}}),this.http=n}}class P extends g{constructor(t){super(t)}signIn(t,r){return this.http.post("/signin",{...t,strategy:r})}signUp(t,r){return this.http.post("/signup",{...t,strategy:r})}updateMissingInformation(t){return this.http.post("/account/updateMissingInformation",t)}requestResetPassword(t){return this.http.post("/account/forgotPassword",{email:t})}resetPassword(t,r){return this.http.post(`/account/resetPassword/${r}`,{password:t})}acceptConsent(){return this.http.post("/signin/consent/confirm")}rejectConsent(){return this.http.get("/signin/consent/reject")}checkPasswordStrength(t,r={}){t=t!=null?t:"";const n={};let{min:i,max:a,number:o,lowerCase:s,upperCase:u,customChars:h,customRegexp:c}=r;return s=Number(s),u=Number(u),o=Number(o),s&&!new RegExp(`(?=(.*[a-z])${s>0?`{${s},}`:""})`).test(t)&&(n.lowerCase=!0),u&&!new RegExp(`(?=(.*[A-Z])${u>0?`{${u},}`:""})`).test(t)&&(n.upperCase=!0),o&&!new RegExp(`(?=(.*[0-9])${o>0?`{${o},}`:""})`).test(t)&&(n.number=!0),i!=null&&t.length<i&&(n.min=!0),a!=null&&t.length>a&&(n.max=!0),h&&!h.split("").some(w=>t.indexOf(w)>-1)&&(n.customChars=!0),c&&c.value&&!new RegExp(c).test(c.value)?c.message||" ":Object.keys(n).length>0?n:!0}}class x extends g{constructor(t){super(t)}async validateCode(t,r){return this.http.post(`/signin/challenge/${r}`,{code:t})}}var N=(e=>(e.SMS="sms",e.EMAIL="email",e.SMARTCARD="sc",e.WEBAUTHN="webauthn",e.FINGER_VEIN="fv",e.OTP="otp",e))(N||{});class k{constructor(t){f(this,"auth");f(this,"mfa");try{t==="/"||new URL(t)}catch{throw new Error('"apiURL" must be a valid URL')}this.auth=new P(t),this.mfa=new x(t)}}exports.AuthService=P;exports.HttpService=g;exports.MFACodeType=N;exports.MFAService=x;exports.PlusAuthWeb=k;exports.isPlatformAuthenticatorAvailable=j;exports.isWebAuthNAutofillSupported=C;exports.isWebAuthNSupported=p;exports.registerDevice=U;exports.verifyDevice=$;
//# sourceMappingURL=plusauth-web.js.map
