{"version":3,"file":"plusauth-web.js","sources":["../node_modules/@simplewebauthn/browser/dist/bundle/index.js","../src/http.ts","../src/auth/auth.ts","../src/auth/mfa.ts","../src/constants/mfa_code_type.ts","../src/index.ts"],"sourcesContent":["/* [@simplewebauthn/browser@6.2.1] */\nfunction utf8StringToBuffer(value) {\n    return new TextEncoder().encode(value);\n}\n\nfunction bufferToBase64URLString(buffer) {\n    const bytes = new Uint8Array(buffer);\n    let str = '';\n    for (const charCode of bytes) {\n        str += String.fromCharCode(charCode);\n    }\n    const base64String = btoa(str);\n    return base64String.replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '');\n}\n\nfunction base64URLStringToBuffer(base64URLString) {\n    const base64 = base64URLString.replace(/-/g, '+').replace(/_/g, '/');\n    const padLength = (4 - (base64.length % 4)) % 4;\n    const padded = base64.padEnd(base64.length + padLength, '=');\n    const binary = atob(padded);\n    const buffer = new ArrayBuffer(binary.length);\n    const bytes = new Uint8Array(buffer);\n    for (let i = 0; i < binary.length; i++) {\n        bytes[i] = binary.charCodeAt(i);\n    }\n    return buffer;\n}\n\nfunction browserSupportsWebAuthn() {\n    return ((window === null || window === void 0 ? void 0 : window.PublicKeyCredential) !== undefined && typeof window.PublicKeyCredential === 'function');\n}\n\nfunction toPublicKeyCredentialDescriptor(descriptor) {\n    const { id } = descriptor;\n    return {\n        ...descriptor,\n        id: base64URLStringToBuffer(id),\n        transports: descriptor.transports,\n    };\n}\n\nfunction isValidDomain(hostname) {\n    return (hostname === 'localhost' || /^([a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}$/i.test(hostname));\n}\n\nclass WebAuthnError extends Error {\n    constructor(message, name = 'WebAuthnError') {\n        super(message);\n        this.name = name;\n    }\n}\n\nfunction identifyRegistrationError({ error, options, }) {\n    var _a, _b;\n    const { publicKey } = options;\n    if (!publicKey) {\n        throw Error('options was missing required publicKey property');\n    }\n    if (error.name === 'AbortError') {\n        if (options.signal === new AbortController().signal) {\n            return new WebAuthnError('Registration ceremony was sent an abort signal', 'AbortError');\n        }\n    }\n    else if (error.name === 'ConstraintError') {\n        if (((_a = publicKey.authenticatorSelection) === null || _a === void 0 ? void 0 : _a.requireResidentKey) === true) {\n            return new WebAuthnError('Discoverable credentials were required but no available authenticator supported it', 'ConstraintError');\n        }\n        else if (((_b = publicKey.authenticatorSelection) === null || _b === void 0 ? void 0 : _b.userVerification) === 'required') {\n            return new WebAuthnError('User verification was required but no available authenticator supported it', 'ConstraintError');\n        }\n    }\n    else if (error.name === 'InvalidStateError') {\n        return new WebAuthnError('The authenticator was previously registered', 'InvalidStateError');\n    }\n    else if (error.name === 'NotAllowedError') {\n        return new WebAuthnError('User clicked cancel, or the registration ceremony timed out', 'NotAllowedError');\n    }\n    else if (error.name === 'NotSupportedError') {\n        const validPubKeyCredParams = publicKey.pubKeyCredParams.filter(param => param.type === 'public-key');\n        if (validPubKeyCredParams.length === 0) {\n            return new WebAuthnError('No entry in pubKeyCredParams was of type \"public-key\"', 'NotSupportedError');\n        }\n        return new WebAuthnError('No available authenticator supported any of the specified pubKeyCredParams algorithms', 'NotSupportedError');\n    }\n    else if (error.name === 'SecurityError') {\n        const effectiveDomain = window.location.hostname;\n        if (!isValidDomain(effectiveDomain)) {\n            return new WebAuthnError(`${window.location.hostname} is an invalid domain`, 'SecurityError');\n        }\n        else if (publicKey.rp.id !== effectiveDomain) {\n            return new WebAuthnError(`The RP ID \"${publicKey.rp.id}\" is invalid for this domain`, 'SecurityError');\n        }\n    }\n    else if (error.name === 'TypeError') {\n        if (publicKey.user.id.byteLength < 1 || publicKey.user.id.byteLength > 64) {\n            return new WebAuthnError('User ID was not between 1 and 64 characters', 'TypeError');\n        }\n    }\n    else if (error.name === 'UnknownError') {\n        return new WebAuthnError('The authenticator was unable to process the specified options, or could not create a new credential', 'UnknownError');\n    }\n    return error;\n}\n\nclass WebAuthnAbortService {\n    createNewAbortSignal() {\n        if (this.controller) {\n            this.controller.abort('Cancelling existing WebAuthn API call for new one');\n        }\n        this.controller = new AbortController();\n        return this.controller.signal;\n    }\n}\nconst webauthnAbortService = new WebAuthnAbortService();\n\nasync function startRegistration(creationOptionsJSON) {\n    if (!browserSupportsWebAuthn()) {\n        throw new Error('WebAuthn is not supported in this browser');\n    }\n    const publicKey = {\n        ...creationOptionsJSON,\n        challenge: base64URLStringToBuffer(creationOptionsJSON.challenge),\n        user: {\n            ...creationOptionsJSON.user,\n            id: utf8StringToBuffer(creationOptionsJSON.user.id),\n        },\n        excludeCredentials: creationOptionsJSON.excludeCredentials.map(toPublicKeyCredentialDescriptor),\n    };\n    const options = { publicKey };\n    options.signal = webauthnAbortService.createNewAbortSignal();\n    let credential;\n    try {\n        credential = (await navigator.credentials.create(options));\n    }\n    catch (err) {\n        throw identifyRegistrationError({ error: err, options });\n    }\n    if (!credential) {\n        throw new Error('Registration was not completed');\n    }\n    const { id, rawId, response, type } = credential;\n    const credentialJSON = {\n        id,\n        rawId: bufferToBase64URLString(rawId),\n        response: {\n            attestationObject: bufferToBase64URLString(response.attestationObject),\n            clientDataJSON: bufferToBase64URLString(response.clientDataJSON),\n        },\n        type,\n        clientExtensionResults: credential.getClientExtensionResults(),\n        authenticatorAttachment: credential.authenticatorAttachment,\n    };\n    if (typeof response.getTransports === 'function') {\n        credentialJSON.transports = response.getTransports();\n    }\n    return credentialJSON;\n}\n\nfunction bufferToUTF8String(value) {\n    return new TextDecoder('utf-8').decode(value);\n}\n\nasync function browserSupportsWebAuthnAutofill() {\n    if (navigator.credentials.conditionalMediationSupported) {\n        return true;\n    }\n    const globalPublicKeyCredential = window.PublicKeyCredential;\n    return (globalPublicKeyCredential.isConditionalMediationAvailable !== undefined &&\n        globalPublicKeyCredential.isConditionalMediationAvailable());\n}\n\nfunction identifyAuthenticationError({ error, options, }) {\n    var _a;\n    const { publicKey } = options;\n    if (!publicKey) {\n        throw Error('options was missing required publicKey property');\n    }\n    if (error.name === 'AbortError') {\n        if (options.signal === new AbortController().signal) {\n            return new WebAuthnError('Authentication ceremony was sent an abort signal', 'AbortError');\n        }\n    }\n    else if (error.name === 'NotAllowedError') {\n        if ((_a = publicKey.allowCredentials) === null || _a === void 0 ? void 0 : _a.length) {\n            return new WebAuthnError('No available authenticator recognized any of the allowed credentials', 'NotAllowedError');\n        }\n        return new WebAuthnError('User clicked cancel, or the authentication ceremony timed out', 'NotAllowedError');\n    }\n    else if (error.name === 'SecurityError') {\n        const effectiveDomain = window.location.hostname;\n        if (!isValidDomain(effectiveDomain)) {\n            return new WebAuthnError(`${window.location.hostname} is an invalid domain`, 'SecurityError');\n        }\n        else if (publicKey.rpId !== effectiveDomain) {\n            return new WebAuthnError(`The RP ID \"${publicKey.rpId}\" is invalid for this domain`, 'SecurityError');\n        }\n    }\n    else if (error.name === 'UnknownError') {\n        return new WebAuthnError('The authenticator was unable to process the specified options, or could not create a new assertion signature', 'UnknownError');\n    }\n    return error;\n}\n\nasync function startAuthentication(requestOptionsJSON, useBrowserAutofill = false) {\n    var _a, _b;\n    if (!browserSupportsWebAuthn()) {\n        throw new Error('WebAuthn is not supported in this browser');\n    }\n    let allowCredentials;\n    if (((_a = requestOptionsJSON.allowCredentials) === null || _a === void 0 ? void 0 : _a.length) !== 0) {\n        allowCredentials = (_b = requestOptionsJSON.allowCredentials) === null || _b === void 0 ? void 0 : _b.map(toPublicKeyCredentialDescriptor);\n    }\n    const publicKey = {\n        ...requestOptionsJSON,\n        challenge: base64URLStringToBuffer(requestOptionsJSON.challenge),\n        allowCredentials,\n    };\n    const options = {};\n    if (useBrowserAutofill) {\n        if (!(await browserSupportsWebAuthnAutofill())) {\n            throw Error('Browser does not support WebAuthn autofill');\n        }\n        const eligibleInputs = document.querySelectorAll(\"input[autocomplete*='webauthn']\");\n        if (eligibleInputs.length < 1) {\n            throw Error('No <input> with `\"webauthn\"` in its `autocomplete` attribute was detected');\n        }\n        options.mediation = 'conditional';\n        publicKey.allowCredentials = [];\n    }\n    options.publicKey = publicKey;\n    options.signal = webauthnAbortService.createNewAbortSignal();\n    let credential;\n    try {\n        credential = (await navigator.credentials.get(options));\n    }\n    catch (err) {\n        throw identifyAuthenticationError({ error: err, options });\n    }\n    if (!credential) {\n        throw new Error('Authentication was not completed');\n    }\n    const { id, rawId, response, type } = credential;\n    let userHandle = undefined;\n    if (response.userHandle) {\n        userHandle = bufferToUTF8String(response.userHandle);\n    }\n    return {\n        id,\n        rawId: bufferToBase64URLString(rawId),\n        response: {\n            authenticatorData: bufferToBase64URLString(response.authenticatorData),\n            clientDataJSON: bufferToBase64URLString(response.clientDataJSON),\n            signature: bufferToBase64URLString(response.signature),\n            userHandle,\n        },\n        type,\n        clientExtensionResults: credential.getClientExtensionResults(),\n        authenticatorAttachment: credential.authenticatorAttachment,\n    };\n}\n\nasync function platformAuthenticatorIsAvailable() {\n    if (!browserSupportsWebAuthn()) {\n        return false;\n    }\n    return PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();\n}\n\nexport { browserSupportsWebAuthn, browserSupportsWebAuthnAutofill, platformAuthenticatorIsAvailable, startAuthentication, startRegistration };\n","/**\n * @internal\n */\nfunction fetchAsPromise( url: string, options: RequestInit ) {\n  return new Promise( function ( resolve, reject ){\n    fetch( url, options ).then( rawResponse => {\n      const contentType = rawResponse.headers.get( 'content-type' )\n      // const clone = rawResponse.clone()\n      let response = null\n      rawResponse.text().then( value => {\n        if ( contentType && contentType.indexOf( 'application/json' ) > -1 ){\n          response = Object.assign( JSON.parse( value ), { _raw: rawResponse } )\n        } else {\n          response = { data: value, _raw: rawResponse }\n        }\n        // TODO: migrate to object response\n        // response.__proto__._raw = clone\n\n        if ( rawResponse.ok ){\n          resolve( response )\n        } else if ( rawResponse.status === 400\n                    && response.error === 'xhr_request'\n                    && response.location ){\n          window.location.replace( response.location );\n          return false;\n        } else {\n          reject( response )\n        }\n      } )\n    } ).catch( reject )\n  } )\n}\n\n/**\n * Helper service for posting requests. It is intended to be used internally.\n * @public\n */\nexport class HttpService {\n  /**\n   * @internal\n   */\n  http: any\n\n  ['constructor']!: typeof HttpService\n\n  constructor( apiURL: string, options?: Partial<RequestInit> ) {\n    const http: any = {};\n    ['get', 'post', 'patch', 'delete'].forEach( method => {\n      http[method] = function ( ...args: any[] ) {\n        const fetchOptions: RequestInit = Object.assign( {\n          method,\n          credentials: 'include',\n          mode:        'cors',\n        }, options || {} )\n\n        fetchOptions.headers = Object.assign( {\n          'Content-Type':     'application/json',\n          'Accept':           'application/json',\n          'X-Requested-With': 'XMLHttpRequest'\n        }, fetchOptions.headers || {} )\n\n        method !== 'get' ? fetchOptions.body = JSON.stringify( args[1] ) : null\n        if ( typeof args[0] !== 'string' ){\n          return fetchAsPromise.call( null, apiURL, fetchOptions )\n        } else {\n          return fetchAsPromise.call( null, apiURL + args[0], fetchOptions )\n        }\n      }\n    } )\n    this.http = http\n  }\n}\n","import { HttpService } from '../http';\n\n/**\n * Class containing authorization related methods.\n * @public\n */\nexport class AuthService extends HttpService {\n  /**\n   * @internal\n   */\n  constructor( baseURL: string ) {\n    super( baseURL );\n  }\n\n  /**\n   * Submits user credentials to the endpoint `/signin`.\n   *\n   * @param fields - Key/Value object for validating user.\n   * @param strategy - PlusAuth strategy to check user. Make sure you have created this strategy\n   * in your tenant.\n   *\n   * @example\n   * Here is a simple usage.\n   * ```js\n   *  auth.signIn( { username: \"johndoe@example.com\", password: \"mypassword\" } )\n   * ```\n   *\n   * @example\n   * With different strategy.\n   * ```js\n   *  auth.signIn( { username: \"johndoe@example.com\", password: \"mypassword\" }, \"myLdapStrategy\" )\n   * ```\n   */\n  public signIn( fields: { [key: string]: any }, strategy?: string ): Promise<any> {\n    return this.http.post( '/signin', { ...fields, strategy } );\n  }\n\n  /**\n   * Posts a request for registering a user.\n   *\n   * @param fields - Key/Value object containing user information.\n   * @param strategy - PlusAuth strategy to create the user for. Make sure you have created this\n   * strategy in your tenant.\n   *\n   * @example\n   * Here is a simple usage.\n   * ```\n   *  auth.signUp( { username: \"johndoe@example.com\", password: \"mypassword\" } )\n   * ```\n   *\n   * @example\n   * With phone number.\n   * ```\n   *  auth.signUp( { username: \"johndoe@example.com\", password: \"mypassword\", phone_number: '+11231212123' } )\n   * ```\n   *\n   * @example\n   * With different strategy.\n   * ```js\n   *  auth.signUp( { username: \"johndoe@example.com\", password: \"mypassword\" }, \"myLdapStrategy\" )\n   * ```\n   */\n  public signUp( fields: { [key: string]: any }, strategy?: string ): Promise<any> {\n    return this.http.post( '/signup', { ...fields, strategy } );\n  }\n\n  /**\n   * In some cases user may need to enter additional information for their profile. For example\n   * applications may force users to enter their phone number. `Fill Missing` view in PlusAuth\n   * uses this method to post the form.\n   *\n   * @param fields - Key/Value object containing user information\n   *\n   * @example\n   * ```js\n   * auth.updateMissingInformation({ phone_number: '+1222334455'})\n   * ```\n   */\n  public updateMissingInformation( fields: { [key: string]: any } ): Promise<any> {\n    return this.http.post( '/account/updateMissingInformation', fields );\n  }\n\n  /**\n   * Request password reset email. `Forgot Password` view in PlusAuth uses this method to post\n   * the form.\n   *\n   * @param email - Email of user requesting password reset.\n   *\n   * @example\n   * ```js\n   * auth.requestResetPassword('john@doe.com')\n   * ```\n   */\n  public requestResetPassword( email: string ): Promise<any> {\n    return this.http.post( '/account/forgotPassword', {\n      email,\n    } );\n  }\n\n  /**\n   * After clicking the reset password email, users will be delivered on a page which will\n   * request their new password. Use this method to post their new password and token from the\n   * url. If `Auto SignIn` is enabled in `Settings > Login` user will be redirected to `Tenant Login URL` automatically. `Reset Password` view in PlusAuth uses this method to submit the form.\n   *\n   * @param password - New password of user\n   * @param hash - Received token in the url\n   *\n   * @example\n   * ```js\n   * const pathParts = location.pathname.split('/')\n   * const token = pathParts[pathParts.length - 1];\n   *\n   * auth.resetPassword('NEW_PASSWORD', token).then(function(){\n   *   console.log('Password reset successfully')\n   * })\n   * ```\n   */\n  public resetPassword( password: string, hash: string ): Promise<any> {\n    return this.http.post( `/account/resetPassword/${ hash }`, {\n      password,\n    } );\n  }\n\n\n  /**\n   * Allow applications to access displayed user information. When third-party applications\n   * request to access user information they need the consent of the end user. This method will\n   * allow the 3rd party application to receive the information. `Allow` button in `Consent`\n   * view uses this method.\n   *\n   * @example\n   * ```js\n   * auth.acceptConsent()\n   * ```\n   */\n  public acceptConsent(): Promise<any> {\n    return this.http.post( '/signin/consent/confirm' );\n  }\n\n\n  /**\n   * Forbid applications to access displayed user information. When third-party applications\n   * request to access user information they need the consent of the end user. This method will\n   * reject the 3rd party application's request to receive the information. `Reject` button in\n   * `Consent` view uses this method.\n   *\n   * @example\n   * ```js\n   * auth.rejectConsent()\n   * ```\n   */\n  public rejectConsent(): Promise<any> {\n    return this.http.get( '/signin/consent/reject' );\n  }\n\n  /**\n   * Helper method for checking password strength for rules defined in PlusAuth. This method\n   * would be useful in SignUp and ResetPassword views.\n   *\n   * @param value - Password to check\n   * @param passwordRules - Object containing password rules\n   *\n   * @example\n   * ```js\n   * const password = '123'\n   * const passwordRules = window.PlusAuth.passwordPolicy\n   *\n   * const passwordStrength = auth.checkPasswordStrength(password, passwordRules)\n   *\n   * if( passwordStrength === true ){\n   *   console.log('password is strong enough')\n   * } else {\n   *   console.log('Password is not strong enough', passwordStrength)\n   * }\n   * ```\n   */\n  public checkPasswordStrength( value: string, passwordRules: any = {} ): any {\n    value = value ?? '';\n    const errors: any = {};\n    // eslint-disable-next-line prefer-const\n    let { min, max, number, lowerCase, upperCase, customChars, customRegexp } = passwordRules;\n\n    lowerCase = Number( lowerCase );\n    upperCase = Number( upperCase );\n    number = Number( number );\n    if (\n      lowerCase &&\n      !new RegExp( `(?=(.*[a-z])${ lowerCase > 0 ? `{${ lowerCase },}` : '' })` ).test( value )\n    ) {\n      errors.lowerCase = true;\n    }\n    if (\n      upperCase &&\n      !new RegExp(\n        `(?=(.*[A-Z])${ upperCase > 0 ? `{${ upperCase },}` : '' })`\n      ).test( value )\n    ) {\n      errors.upperCase = true;\n    }\n    if (\n      number &&\n      !new RegExp(\n        `(?=(.*[0-9])${ number > 0 ? `{${ number },}` : '' })`\n      ).test( value )\n    ) {\n      errors.number = true;\n    }\n    if ( min != null && value.length < min ) {\n      errors.min = true;\n    }\n    if ( max != null && value.length > max ) {\n      errors.max = true;\n    }\n    if ( customChars &&\n      !customChars.split( '' ).some( ( char: string ) => value.indexOf( char ) > -1 )\n    ) {\n      errors.customChars = true;\n    }\n\n    if ( customRegexp && customRegexp.value ) {\n      if ( !new RegExp( customRegexp ).test( customRegexp.value ) ) {\n        return customRegexp.message || ' ';\n      }\n    }\n\n    return Object.keys( errors ).length > 0 ? errors : true;\n  }\n}\n","import { MFACodeType } from '../constants';\nimport { HttpService } from '../http';\n\n/**\n * Class containing Multi Factor Authorization related methods.\n * @public\n */\nexport class MFAService extends HttpService {\n  /**\n   * @internal\n   */\n  constructor( baseURL: string ) {\n    super( baseURL );\n  }\n\n  /**\n   * Submit user provided code for validation.\n   *\n   * @param code - User provided code\n   * @param codeType - Method of MFA\n   *\n   * @example\n   * Validate SMS code.\n   * ```js\n   * mfa.validateCode('123456', MFACodeType.SMS).catch( function(err){\n   *   console.error('Code is not valid', err)\n   * })\n   * ```\n   *\n   * @example\n   * Validate Email code.\n   * ```js\n   * mfa.validateCode('123456', MFACodeType.EMAIL).catch( function(err){\n   *   console.error('Code is not valid', err)\n   * })\n   * ```\n   *\n   * @example\n   * Validate OTP code.\n   * ```js\n   * mfa.validateCode('123456', MFACodeType.OTP).catch( function(err){\n   *   console.error('Code is not valid', err)\n   * })\n   *```\n   *\n   * @example\n   * Register WebAuthN device.\n   * ```js\n   * PlusAuthWeb.registerDevice(window.PlusAuth.details.registration_options)\n   * .then(function(deviceRegistrationResult){\n   *    mfa.validateCode(deviceRegistrationResult, MFACodeType.WEBAUTHN).catch( function(err){\n   *      console.error('Registration failed', err)\n   *    })\n   * })\n   *```\n   *\n   * @example\n   * Verify WebAuthN device.\n   * ```js\n   * PlusAuthWeb.verify_device(window.PlusAuth.details.authentication_options)\n   * .then(function(deviceVerificationResult){\n   *    mfa.validateCode(deviceVerificationResult, MFACodeType.WEBAUTHN).catch( function(err){\n   *      console.error('Verification failed', err)\n   *    })\n   * })\n   * ```\n   */\n  public async validateCode(\n    code: Record<string, any>,\n    codeType: MFACodeType.WEBAUTHN\n  ): Promise<any>;\n\n  public async validateCode(\n    code: string,\n    codeType: Exclude<MFACodeType, MFACodeType.WEBAUTHN>\n  ): Promise<any>;\n\n  public async validateCode(\n    code: string | Record<string, any>,\n    codeType: MFACodeType\n  ): Promise<any> {\n    return this.http.post( `/signin/challenge/${ codeType }`, {\n      code\n    } );\n  }\n}\n","/**\n * @packageDocumentation\n * @module Constants\n */\n\n/**\n * Code types to be used in Multi-Factor Authentication\n *\n * @public\n */\nexport enum MFACodeType {\n  SMS = 'sms',\n  EMAIL = 'email',\n  SMARTCARD = 'sc',\n  WEBAUTHN = 'webauthn',\n  FINGER_VEIN = 'fv',\n  OTP = 'otp'\n}\n","/**\n * @packageDocumentation\n */\n\nimport {\n  browserSupportsWebAuthn,\n  browserSupportsWebAuthnAutofill,\n  platformAuthenticatorIsAvailable,\n  startAuthentication,\n  startRegistration\n} from '@simplewebauthn/browser';\n\nimport { AuthService, MFAService } from './auth';\n\nexport * from './http'\nexport * from './auth'\nexport * from './constants'\n\n/**\n * @public\n */\nexport {\n  startAuthentication as verifyDevice,\n  startRegistration as registerDevice,\n  platformAuthenticatorIsAvailable as isPlatformAuthenticatorAvailable,\n  browserSupportsWebAuthnAutofill as isWebAuthNAutofillSupported,\n  browserSupportsWebAuthn as isWebAuthNSupported\n}\n\n/**\n * Main class for initializing the library.\n *\n * @example\n *\n * ```js\n * const pa = new PlusAuthWeb(\"https://mytenant.plusauth.com\")\n *\n * // access auth methods from `auth` property\n * pa.auth.signIn({ username: ..., password: ...})\n *\n * // access MFA methods from `mfa` property\n * pa.mfa.validateCode('code', 'sms')\n * ```\n *\n * @public\n */\nexport class PlusAuthWeb {\n  /**\n   * @readonly\n   */\n  readonly auth: AuthService;\n\n  /**\n   * @readonly\n   */\n  readonly mfa: MFAService;\n\n  /**\n   * @param apiURL - Your PlusAuth tenant url. It must be a valid url.\n   */\n  constructor( apiURL: string ) {\n    try {\n      apiURL === '/' || new URL( apiURL )\n    } catch ( e ) {\n      throw new Error( '\"apiURL\" must be a valid URL' )\n    }\n    this.auth = new AuthService( apiURL )\n    this.mfa = new MFAService( apiURL )\n  }\n}\n\n"],"names":["utf8StringToBuffer","value","bufferToBase64URLString","buffer","bytes","str","charCode","base64URLStringToBuffer","base64URLString","base64","padLength","padded","binary","i","browserSupportsWebAuthn","toPublicKeyCredentialDescriptor","descriptor","id","isValidDomain","hostname","WebAuthnError","message","name","identifyRegistrationError","error","options","_a","_b","publicKey","param","effectiveDomain","WebAuthnAbortService","webauthnAbortService","startRegistration","creationOptionsJSON","credential","err","rawId","response","type","credentialJSON","bufferToUTF8String","browserSupportsWebAuthnAutofill","globalPublicKeyCredential","identifyAuthenticationError","startAuthentication","requestOptionsJSON","useBrowserAutofill","allowCredentials","userHandle","platformAuthenticatorIsAvailable","fetchAsPromise","url","resolve","reject","rawResponse","contentType","HttpService","apiURL","__publicField","http","method","args","fetchOptions","AuthService","baseURL","fields","strategy","email","password","hash","passwordRules","errors","min","max","number","lowerCase","upperCase","customChars","customRegexp","char","MFAService","code","codeType","MFACodeType","PlusAuthWeb"],"mappings":"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"}