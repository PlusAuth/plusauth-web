(function(u,w){typeof exports=="object"&&typeof module<"u"?w(exports):typeof define=="function"&&define.amd?define(["exports"],w):(u=typeof globalThis<"u"?globalThis:u||self,w(u["plusauth-web"]={}))})(this,function(u){"use strict";function w(e){return new TextEncoder().encode(e)}function f(e){const t=new Uint8Array(e);let n="";for(const s of t)n+=String.fromCharCode(s);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function m(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=(4-t.length%4)%4,r=t.padEnd(t.length+n,"="),s=atob(r),a=new ArrayBuffer(s.length),i=new Uint8Array(a);for(let o=0;o<s.length;o++)i[o]=s.charCodeAt(o);return a}function R(){return(window==null?void 0:window.PublicKeyCredential)!==void 0&&typeof window.PublicKeyCredential=="function"}function A(e){const{id:t}=e;return{...e,id:m(t),transports:e.transports}}function y(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}class c extends Error{constructor({message:t,code:n,cause:r,name:s}){super(t,{cause:r}),this.name=s??r.name,this.code=n}}function D({error:e,options:t}){var r,s;const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new c({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=n.authenticatorSelection)==null?void 0:r.requireResidentKey)===!0)return new c({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(((s=n.authenticatorSelection)==null?void 0:s.userVerification)==="required")return new c({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new c({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new c({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return n.pubKeyCredParams.filter(i=>i.type==="public-key").length===0?new c({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new c({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const a=window.location.hostname;if(y(a)){if(n.rp.id!==a)return new c({message:`The RP ID "${n.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new c({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(n.user.id.byteLength<1||n.user.id.byteLength>64)return new c({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new c({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}class N{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const t=new AbortController;return this.controller=t,t.signal}}const _=new N,v=["cross-platform","platform"];function S(e){if(e&&!(v.indexOf(e)<0))return e}async function K(e){var b;if(!R())throw new Error("WebAuthn is not supported in this browser");const n={publicKey:{...e,challenge:m(e.challenge),user:{...e.user,id:w(e.user.id)},excludeCredentials:(b=e.excludeCredentials)==null?void 0:b.map(A)}};n.signal=_.createNewAbortSignal();let r;try{r=await navigator.credentials.create(n)}catch(g){throw D({error:g,options:n})}if(!r)throw new Error("Registration was not completed");const{id:s,rawId:a,response:i,type:o}=r;let l;typeof i.getTransports=="function"&&(l=i.getTransports());let h;typeof i.getPublicKeyAlgorithm=="function"&&(h=i.getPublicKeyAlgorithm());let d;if(typeof i.getPublicKey=="function"){const g=i.getPublicKey();g!==null&&(d=f(g))}let p;return typeof i.getAuthenticatorData=="function"&&(p=f(i.getAuthenticatorData())),{id:s,rawId:f(a),response:{attestationObject:f(i.attestationObject),clientDataJSON:f(i.clientDataJSON),transports:l,publicKeyAlgorithm:h,publicKey:d,authenticatorData:p},type:o,clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:S(r.authenticatorAttachment)}}function U(e){return new TextDecoder("utf-8").decode(e)}function P(){const e=window.PublicKeyCredential;return e.isConditionalMediationAvailable===void 0?new Promise(t=>t(!1)):e.isConditionalMediationAvailable()}function L({error:e,options:t}){const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new c({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new c({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const r=window.location.hostname;if(y(r)){if(n.rpId!==r)return new c({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new c({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new c({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}async function H(e,t=!1){var p,b;if(!R())throw new Error("WebAuthn is not supported in this browser");let n;((p=e.allowCredentials)==null?void 0:p.length)!==0&&(n=(b=e.allowCredentials)==null?void 0:b.map(A));const r={...e,challenge:m(e.challenge),allowCredentials:n},s={};if(t){if(!await P())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete*='webauthn']").length<1)throw Error('No <input> with `"webauthn"` in its `autocomplete` attribute was detected');s.mediation="conditional",r.allowCredentials=[]}s.publicKey=r,s.signal=_.createNewAbortSignal();let a;try{a=await navigator.credentials.get(s)}catch(g){throw L({error:g,options:s})}if(!a)throw new Error("Authentication was not completed");const{id:i,rawId:o,response:l,type:h}=a;let d;return l.userHandle&&(d=U(l.userHandle)),{id:i,rawId:f(o),response:{authenticatorData:f(l.authenticatorData),clientDataJSON:f(l.clientDataJSON),signature:f(l.signature),userHandle:d},type:h,clientExtensionResults:a.getClientExtensionResults(),authenticatorAttachment:S(a.authenticatorAttachment)}}function M(){return R()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():new Promise(e=>e(!1))}function I(e,t){return new Promise(function(n,r){fetch(e,t).then(s=>{const a=s.headers.get("content-type");if(s.redirected&&a&&a.includes("html"))return window.location.assign(s.url),!1;let i=null;s.text().then(o=>{if(a&&a.includes("json")?i=Object.assign(JSON.parse(o),{_raw:s}):i={data:o,_raw:s},s.ok)n(i);else{if(s.status===400&&i.error==="xhr_request"&&i.location)return window.location.replace(i.location),!1;r(i)}})}).catch(r)})}class E{constructor(t,n){const r={};["get","post","patch","delete"].forEach(s=>{r[s]=function(...a){const i=Object.assign({method:s,credentials:"include",mode:"cors"},n||{});return i.headers=Object.assign({"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},i.headers||{}),s!=="get"&&(i.body=JSON.stringify(a[1])),typeof a[0]!="string"?I.call(null,t,i):I.call(null,t+a[0],i)}}),this.http=r}}class C extends E{constructor(t){super(t)}signIn(t,n){return this.http.post("/signin",{...t,connection:n})}signInPasswordless(t,n){return this.http.post(`/signin/passwordless/${t}`,n)}signUp(t,n){return this.http.post("/signup",{...t,strategy:n})}updateMissingInformation(t){return this.http.post("/account/updateMissingInformation",t)}requestResetPassword(t){return this.http.post("/account/forgotPassword",{email:t})}resetPassword(t,n){return this.http.post(`/account/resetPassword/${n}`,{password:t})}acceptConsent(){return this.http.post("/signin/consent/confirm")}rejectConsent(){return this.http.get("/signin/consent/reject")}checkPasswordStrength(t,n={}){t=t??"";const r={};let{min:s,max:a,number:i,lowerCase:o,upperCase:l,customChars:h,customRegexp:d}=n;return o=Number(o),l=Number(l),i=Number(i),o&&!new RegExp(`(?=(.*[a-z])${o>0?`{${o},}`:""})`).test(t)&&(r.lowerCase=!0),l&&!new RegExp(`(?=(.*[A-Z])${l>0?`{${l},}`:""})`).test(t)&&(r.upperCase=!0),i&&!new RegExp(`(?=(.*[0-9])${i>0?`{${i},}`:""})`).test(t)&&(r.number=!0),s!=null&&t.length<s&&(r.min=!0),a!=null&&t.length>a&&(r.max=!0),h&&!h.split("").some(p=>t.indexOf(p)>-1)&&(r.customChars=!0),d&&d.value&&!new RegExp(d).test(d.value)?d.message||" ":Object.keys(r).length>0?r:!0}}class T extends E{constructor(t){super(t)}async validateCode(t,n){return this.http.post(`/signin/challenge/${t}`,{code:n})}}var O=(e=>(e.SMS="sms",e.EMAIL="email",e.SMARTCARD="sc",e.WEBAUTHN="webauthn",e.FINGER_VEIN="fv",e.OTP="otp",e))(O||{});class x{constructor(t){try{t==="/"||new URL(t)}catch{throw new Error('"apiURL" must be a valid URL')}this.auth=new C(t),this.mfa=new T(t)}}u.AuthService=C,u.HttpService=E,u.MFACodeType=O,u.MFAService=T,u.PlusAuthWeb=x,u.isPlatformAuthenticatorAvailable=M,u.isWebAuthNAutofillSupported=P,u.isWebAuthNSupported=R,u.registerDevice=K,u.verifyDevice=H,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=plusauth-web.umd.js.map
